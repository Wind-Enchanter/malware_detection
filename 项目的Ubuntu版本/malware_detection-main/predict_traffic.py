import tensorflow as tf
import torch
import pandas as pd
from tensorflow.python.keras.models import load_model
import numpy as np
import csv


def traffic_predict(pre_data, model_path):
    my_model = load_model(model_path)
    print(my_model.summary)

    pred = my_model.predict(pre_data)

    print('Output of the softmax layer', pred[0])
    print('Network prediction:', np.argmax([pred[0]]))
    return pred


def load_traffic_data(pic_path):
    pic_data = tf.io.read_file(pic_path)
    pic_data = tf.image.decode_jpeg(pic_data, channels=1)  # RGBA
    pic_data = tf.image.resize(pic_data, [28, 28])
    pic_data = tf.cast(pic_data, dtype=tf.float32) / 255.
    pic_data = np.array(pic_data).reshape(1, 28, 28, 1)
    return pic_data


if __name__ == "__main__":
    traffic_pic = 'D:/USTC-TK2016/pic/8080.png'
    model_p = './classification_traffic/traffic_class.h5'
    x = load_traffic_data(traffic_pic)
    traffic_predict(x, model_p)
